{% extends "base.html" %}
{% block title %}Confirmación de pedido – Ctrl+Store{% endblock %}

{% block content %}
<div class="container my-5">
  <h1 class="mb-4">¡Gracias por tu compra!</h1>

  {% if payment.status == 'captured' %}
    
  {% else %}
    <div class="alert alert-danger">
      Pago con estado: {{ payment.status }} — {{ payment.error_message }}
    </div>
  {% endif %}

  <div class="row g-4">
    <!-- Resumen de la orden -->
    <div class="col-lg-7">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Resumen de la orden</h5>

          <ul class="list-group list-group-flush">
            {% for it in items %}
              <li class="list-group-item d-flex justify-content-between align-items-center bg-dark text-light border-secondary">
                <div>
                  <div class="fw-semibold">{{ it.product.name }}</div>
                  <small class="text-muted">x{{ it.quantity }} · ${{ it.unit_price }}</small>
                </div>
                <div><strong>${{ it.line_total }}</strong></div>
              </li>
            {% endfor %}
          </ul>

          <div class="mt-3">
            <div class="d-flex justify-content-between"><span>Subtotal</span><span>${{ order.subtotal_amount }}</span></div>
            <div class="d-flex justify-content-between"><span>Envío</span><span>${{ order.shipping_amount }}</span></div>
            <div class="d-flex justify-content-between fs-4 fw-bold border-top pt-2">
              <span>Total</span><span>${{ order.total_amount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dirección & Contacto + Método de pago -->
    <div class="col-lg-5">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Dirección & Contacto</h5>

          <dl class="row mb-0">
            <dt class="col-sm-5">Nombre</dt>
            <dd class="col-sm-7">{{ order.full_name }}</dd>

            <dt class="col-sm-5">Dirección</dt>
            <dd class="col-sm-7">
              {{ order.address_line1 }}{% if order.address_line2 %}, {{ order.address_line2 }}{% endif %}
            </dd>

            <dt class="col-sm-5">Ciudad/Estado</dt>
            <dd class="col-sm-7">
              {{ order.city }}{% if order.state %}, {{ order.state }}{% endif %}
            </dd>

            <dt class="col-sm-5">Código Postal</dt>
            <dd class="col-sm-7">{{ order.postal_code|default:"—" }}</dd>

            <dt class="col-sm-5">País</dt>
            <dd class="col-sm-7">{{ order.country }}</dd>

            <dt class="col-sm-5">Email</dt>
            <dd class="col-sm-7">{{ order.email }}</dd>

            {% if order.phone %}
            <dt class="col-sm-5">Teléfono</dt>
            <dd class="col-sm-7">{{ order.phone }}</dd>
            {% endif %}
          </dl>
        </div>
      </div>

      <div class="card shadow-sm rounded-4 mt-3">
        <div class="card-body">
          <h5 class="card-title mb-3">Método de pago</h5>
          <p class="mb-1">{{ payment.brand|title }} •••• {{ payment.last4 }} ({{ payment.method }})</p>
          <p class="text-muted mb-0">Fecha: {{ payment.created_at|date:"Y-m-d H:i" }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <a class="btn btn-outline-primary" href="{% url 'order:checkout' %}">Volver a la tienda</a>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .card.rounded-4 { border-radius: 1rem; }
  .list-group-item.bg-dark { background-color: #1f1f1f !important; }
  .list-group-item.border-secondary { border-color: #2f2f2f !important; }
</style>
{% endblock %}
